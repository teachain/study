##gate服务##
我们设计在connector之前使用一个gate服务，算是一种负载均衡服务，它的行为是：

客户端先连接gate，gate告知客户端应该连接哪个connector，并将connector的地址端口等信息返回，后客户端连接指定的connector

但是这里其实也是存在安全隐患的，如果攻击性的客户端跳过gate的负载均衡，直接连接connector，那么可能导致某个connector崩溃，可能会出现雪崩效应了。


##connector服务##
使用长连接，必然有个服务组件专门服务于长连接的建立，维护，接收和发送消息。我们可以称之为connector。

这个服务需要是分布式的，有多少用户就会有多少个长连接，维护这么多长连接需要使用的是多个机器的服务。而且如果允许的话，建议connector能监听在80端口，以避免客户端的防火墙对端口的限制。

##chat服务##

connector是暴露在服务器前端的，后端必然有个服务能处理聊天的业务逻辑，其功能包括：

A 管理聊天室的用户

B 接收connector发送的群聊或者单聊的消息（通过进程间通信）

C 发送群聊和单聊的消息给对应的connector（通过进程间通信）

这个业务逻辑服务我们称之为chat



DevOps

* Dev(开发)
* Ops(运维)


每个ETCD节点都维护了一个状态机，并且，任意时刻至多存在一个有效的主节点。主节点处理所有来自客户端写操作，通过Raft协议保证写操作对状态机的改动会可靠的同步到其他节点。

ETCD工作原理核心部分在于Raft协议。