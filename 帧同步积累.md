##帧同步##

rts同步的仅仅是操作，即点击了什么位置，点击了什么按钮，选择了什么目标，按了什么按键。客户端接收到对应的操作，进行同样的模拟，达到同样的输出。从而完成网络同步。


 魔兽争霸的录像机制也是基于此原理，记录操作，而不记录状态。
 
 
 帧同步的过程可以简述为：

* 各客户端实时上传操作指令集;
* 服务端保存这些操作指令集，并在下一帧将其广播给所有客户端;
* 客户端收到指令集后分别按帧序执行指令集中的操作。

一些人的做法：

帧同步每个数据都带帧戳，所以很容易用UDP实现。用算法可以把帧判断、防丢包、时间错位等问题一揽子解决。


为了提高实时性，一般也倾向于使用UDP而不是TCP协议，这样底层的处理会更高效。但是，这样也会带来了丢包、乱序的可能性。因此我们常常会以冗余的方式——比如每个帧数据包，实际上是包含了过去2帧的数据，也就是每次发3帧的数据，来对抗丢包。也就是说三个包里面只要有一个包没丢，就不影响游戏。另外我们还会在RelayServer上保存大量的客户端上传的数据，如果客户端发现丢了包（如果乱序了也认为是丢包），那么就发起一次“下载”请求，从服务器上重新下载丢失了的帧数据包（这个可能会使用TCP）。这一切，都依赖于每个帧数据要足够的小。所以我们一般要求，每次客户端发送的数据，应该小于128字节。你可以大概计算一下，如果我们的游戏有4个玩家，我们的冗余是3帧，那么一个下行的网络帧数据包大小会到128x4x3=1536字节，而每秒我们发15个网络帧，那么占用的带宽会到1536x15=23,040字节/秒，加上一些底层协议包头也就是24kB/s，这个速度看起来已经要求手机是3G网络才能支持了（实测中GPRS一般很难稳定到这个速度）。