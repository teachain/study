检查一个区块是否有效的算法如下:

1. 检查区块引用的上一个区块是否存在且有效。
2. 检查区块的时间戳是否晚于以前的区块的时间戳，而且早于未来2小时[2]。 3. 检查区块的工作量证明是否有效。
3. 将上一个区块的最终状态赋于S[0]。(上一个区块最终状态时，谁谁有多少以太币，它的私有数据有哪些，值分别是多少等等)
4. 假设TX是区块的交易列表，包含n笔交易。对于属于0......n-1的所有i,进行状
  态转换 S[i+1] = APPLY(S[i],TX[i])。如果任何一笔交易 i 在状态转换中出错，退
  出程序，返回错误。
5. 返回正确，状态S[n]是这一区块的最终状态。（经过了这些交易之后，谁谁有多少以太币，它的私有数据有哪些，值分别是多少等等，根据交易进行了响应的改变。）

本质上，区块中的每笔交易必须提供一个正确的状态转换，要注意的是，“状态” 并不是编码到区块的。它纯粹只是

被校验节点记住的抽象概念，对于任意区块都 可以从创世状态开始，按顺序加上每一个区块的每一笔交易，(妥妥

地)计算出 当前的状态。另外，需要注意矿工将交易收录进区块的顺序。如果一个区块中有 A、B 两笔交易，B 花

费的是 A 创建的 UTXO，如果 A 在 B 以前，这个区块是有 效的，否则，这个区块是无效的。



以太坊账户

在以太坊系统中，状态是由被称为“账户”(每个账户由一个 20 字节的地址)的

对象和在两个账户之间转移价值和信息的状态转换构成的。以太坊的账户包含四 个部分:

1. 随机数，用于确定每笔交易只能被处理一次的计数器
2. 账户目前的以太币余额
3. 账户的合约代码，如果有的话
4. 账户的存储(默认为空)

以太币(Ether)是以太坊内部的主要加密燃料，用于支付交易费用。一般而言， 以太坊有两种类型的账户:外部所有的账户(由私钥控制的)和合约账户(由合 约代码控制)。外部所有的账户没有代码，人们可以通过创建和签名一笔交易从 一个外部账户发送消息。每当合约账户收到一条消息，合约内部的代码就会被激 活，允许它对内部存储进行读取和写入，和发送其它消息或者创建合约。



3.共识（Consensus）机制
解决区块链如何在分布式场景下达成一致性和有效性的机制。

3.1 POW（Proof of Work）
基于工作量证明的共识机制。

3.2 POS（Proof of Stake）
基于权益证明的共识机制。

3.3 DPOS（Delegated Proof of Stake）
基于授权权益证明的共识机制。

3.4 IPFS（Inter Planetary File System）
一种分布式文件系统协议。

3.5 PBFT（Practical Byzantine Fault Tolerance）

实用拜占庭容错算法。



区块链节点利用SPV对支付进行验证的工作原理如下：

①计算待验证支付的交易哈希值；

②节点从区块链网络上获取并存储最长链的所有区块头至本地；

③节点从区块链获取待验证支付对应的默克尔树哈希认证路径；

④根据哈希认证路径，计算默克尔树的根哈希值，将计算结果与本地区块头中的默克尔树的根哈希值进行比较，定位到包含待验证支付的区块；

⑤验证该区块的区块头是否已经包含在已知最长链中，如果包含则证明支付真实有效；

⑥根据该区块头所处的位置，确定该支付已经得到的确认数量。

### 这点很重要

验证路径是从其他节点获取来的。