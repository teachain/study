```
Start()
run()
startListening()----》listenLoop()
listenLoop()
net.Conn-->p2p.meteredConn(加入了)-->conn
net.Conn-->p2p.meteredConn(加入了)-->transport


//消息是这么走的
authMsgV4-->authRespV4->protoHandshake-->protoHandshake
```



从底层的tcp连接建立之后，进行握手协议，经过了握手之后，交给上层处理。eth/handler.go



侧链与主链沟通的过程被称为成为“双向锚定”

在区块链中，由于比特币实际上不是简单的“转移”，而是暂时将其在比特币区块链上锁定，之后将等量等值的代币在侧链上释放。当等量等值的代币在侧链上被锁定时，比特币区块链上的原始比特币就可以被释放了。因此，“双向锚定”实际上就是一方是否解锁，要以另一方是否已经有投币行为为基准。



https://t.cj.sina.com.cn/articles/view/1779624225/6a12e92101900dv34



从侧链到跨链

不同于侧链，跨链中，链与链的关系是对等的。用户可以通过“双向锚定” 来“转移”比特币。同时，跨链还可以实现

汇率兑换、智能合约交互等功能状态的转移、交换。

和侧链技术一样，跨链技术也需要解决资产的锁定与管理问题。

除了我们在侧链部分已经提到的的单一托管人模式和联盟托管模式，对于被跨的链中包含以太坊的情况来说，智能合约管理模式可以派得上用场。这个管理模式的关键就在于这个智能合约中需要包含双方区块链的区块头，从而验证双方的线上交易。